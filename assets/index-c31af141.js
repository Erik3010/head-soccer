(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class p{constructor({ctx:t}){this.ctx=t}draw(){}}class m extends p{constructor({ctx:t,x:e,y:s,width:i,height:r,imageSrc:n=null,image:o=null,isFlip:h=!1}){super({ctx:t}),this.x=e,this.y=s,this.width=i,this.height=r,this.isFlip=h,this.imageSrc=n,this.image=o,!this.image&&this.imageSrc&&(this.image=new Image,this.image.src=this.imageSrc)}get renderCoordinate(){return{x:this.x,y:this.y}}get drawImageParams(){const{x:t,y:e}=this.renderCoordinate,s=this.isFlip?-1:1;return[this.image,t*s,e,this.width*s,this.height]}beforeDraw(){}draw(){this.update(),this.image&&(this.ctx.save(),this.isFlip&&this.ctx.scale(-1,1),this.beforeDraw(),this.ctx.drawImage(...this.drawImageParams),this.ctx.restore())}update(){}}class D extends m{constructor({type:t,...e}){super({...e,x:0,y:0}),this.type=t}}class E extends p{constructor({ctx:t,x:e,y:s,width:i,height:r,flagImage:n}){super({ctx:t}),this.x=e,this.y=s,this.width=i,this.height=r,this.flagImage=n,this.flagCount=10}draw(){for(let t=0;t<this.flagCount;t++)this.ctx.save(),this.ctx.drawImage(t%2===0?this.flagImage.player:this.flagImage.opponent,this.x+t*this.width,this.y,this.width,this.height),this.ctx.restore()}}const d={brazil:{name:"Brazil",code:"01"},england:{name:"England",code:"02"},spain:{name:"Spain",code:"03"},japan:{name:"Japan",code:"04"},netherlands:{name:"Netherlands",code:"05"},portugal:{name:"Portugal",code:"06"},germany:{name:"Germany",code:"07"},italy:{name:"Italy",code:"08"}},l={falling_down:"Falling Down",idle:"Idle",jump:"Jump",kick:"Kick",move_backward:"Move Backward",move_forward:"Move Forward"},z={[l.falling_down]:5,[l.idle]:18,[l.jump]:5,[l.kick]:9,[l.move_backward]:10,[l.move_forward]:10},G={out_door:"background1",stadium:"background2"},M={general:"Ball 01",special:"Ball 02"},R=["KeyA","KeyD"],K=["KeyW"],$=["Space"],q={KeyA:-1,KeyD:1},H={easy:30,medium:20,hard:15};class N extends m{constructor({sprites:t,...e}){super(e),this.sprites=t,this.spriteCounter=0,this.currentFrameIndex=0}get frameBuffer(){return 3}get currentSprite(){return this.sprites[this.currentFrameIndex]}update(){super.update(),this.updateFrame()}get shouldUpdateFrame(){return this.spriteCounter%this.frameBuffer===0}updateFrame(){this.spriteCounter++,this.shouldUpdateFrame&&(this.currentFrameIndex=++this.currentFrameIndex%this.sprites.length,this.image=this.currentSprite)}resetSpriteAnimation(){this.spriteCounter=0,this.currentFrameIndex=0}}class T extends N{constructor({sprites:t,gameInstance:e,...s}){super({...s,sprites:t[l.idle]}),this.game=e,this.state=l.idle,this.spriteCollection=t,this.gravity=.5,this.moveSpeed=5,this.jumpHeight=15,this.isKick=!1,this.velocity={x:0,y:0}}update(){super.update(),this.watchState(),this.applyVelocity(),this.applyGravity(),this.restrictToBottom()}watchState(){const t=this.spriteCollection[l.kick].length;if(this.isKick){if(this.currentFrameIndex<t-1)return;this.isKick=!1,this.resetSpriteAnimation()}this.velocity.y!==0?this.updateState(l.jump):this.velocity.x!==0?this.updateState(this.velocity.x>0?l.move_forward:l.move_backward):this.updateState(l.idle)}applyGravity(){this.velocity.y+=this.gravity}applyVelocity(){this.x+=this.velocity.x,this.y+=this.velocity.y}restrictToBottom(){const t=this.game.height-this.height-this.game.bottomGap;this.y>=t&&(this.y=t,this.velocity.y=0)}updateState(t){this.state!==t&&(this.state=t,this.resetSpriteAnimation(),this.sprites=this.spriteCollection[this.state])}move(t){this.velocity.x=t*this.moveSpeed}stopMove(){this.velocity.x=0}jump(){this.velocity.y!==0&&(this.velocity.y=0),this.velocity.y-=this.jumpHeight}kick(){this.isKick=!0,this.updateState(l.kick)}}class P extends m{constructor({side:t,...e}){super(e),this.isGoal=!1,this.side=t}}const u=async a=>new Promise(t=>{const e=new Image;e.src=a,e.addEventListener("load",()=>t(e))}),O=(a,t=3)=>a.toString().padStart(t,"0"),v=a=>R.includes(a),U=a=>K.includes(a),k=a=>$.includes(a),I=a=>v(a)||U(a)||k(a),_=(a,t,e,s,i)=>{const r=e-t,n=i-s;return(a-t)/r*n+s},V=(a,t,e)=>Math.min(e,Math.max(t,a)),x=(a,t)=>a.x+a.width>=t.x&&a.x<=t.x+t.width&&a.y+a.height>=t.y&&a.y<=t.y+t.height,C=(a,t)=>{const e={x:a.x+a.width/2-(t.x+t.width/2),y:a.y+a.height/2-(t.y+t.height/2)},s={x:a.width/2+t.width/2,y:a.height/2+t.height/2},i={x:e.x>0?s.x-e.x:-s.x-e.x,y:e.y>0?s.y-e.y:-s.y-e.y};if(i.x||i.y)return Math.abs(i.x)<Math.abs(i.y)?e.x>0?"left":"right":e.y>0?"top":"bottom"},g=(a,t)=>Math.floor(Math.random()*(t-a+1))+a,L=(a,t,e)=>(t/=e/2,t<1?a/2*Math.pow(t,3):(t-=2,a/2*(Math.pow(t,3)+2))),f=a=>{var t;return((t=document.querySelector(`[name='${a}']:checked`))==null?void 0:t.value)??null};class W{constructor({backgroundType:t,ballType:e,player:s,opponent:i}){this.assets={background:null,ball:null,goal:null,goalText:null,diamondIce:null,decreaseBall:null,increaseBall:null,character:{player:null,opponent:null},flag:{player:null,opponent:null}},this.assetUrl="./assets",this.characterAssetUrl=`${this.assetUrl}/Characters`,this.flagAssetUrl=`${this.assetUrl}/Flag`,this.backgroundType=t,this.ballType=e,this.player=s,this.opponent=i,this.assetFileName={background:`${this.backgroundType}.jpg`,ball:`${this.ballType}.png`,goal:"Goal - Side.png",decreaseBall:"Decrease Ball.png",increaseBall:"Increase Ball.png",diamondIce:"Diamond Ice.png",goalText:"Goal - Text.png",scoreBar:"Score Bar.png"}}async loadAssets(){for(const s in this.assetFileName){const i=`${this.assetUrl}/${this.assetFileName[s]}`;this.assets[s]=await u(i)}this.assets.flag.player=await u(`${this.flagAssetUrl}/${d[this.player].name}.png`),this.assets.flag.opponent=await u(`${this.flagAssetUrl}/${d[this.opponent].name}.png`);const t=await this.loadCharacterSprite(this.player),e=await this.loadCharacterSprite(this.opponent);this.assets.character.player=t,this.assets.character.opponent=e}async loadCharacterSprite(t){const e={};for(const s in l){const i=l[s],r=z[i],{name:n,code:o}=d[t];e[i]=[];for(let h=0;h<r;h++){const c=O(h),w=`${i}_${c}`,F=`${this.characterAssetUrl}/Character ${o} - ${n}/${i}/${w}.png`;e[i].push(await u(F))}}return e}}class X extends m{constructor({gameInstance:t,...e}){super(e),this.game=t,this.velocity={x:0,y:0},this.previousVelocity=null,this.actualSize={width:this.width,height:this.height},this.gravity=.5,this.bounce=.7,this.angle=0,this.force=0,this.scale=1,this.scaleAmount=.25,this.maxScale=2.5,this.minScale=.5,this.isFreezeBall=!1}update(){super.update(),!this.isFreezeBall&&this.applyGravity(),this.applyVelocity(),this.constrainToGameArea()}constrainToGameArea(){const t=this.game.height-this.height-(this.game.bottomGap+20),e=this.game.width-this.width;this.y>t&&(this.y=t,this.velocity.y*=-this.bounce),this.x>e&&(this.x=e,this.velocity.x*=-this.bounce),this.x<0&&(this.x=0,this.velocity.x*=-this.bounce)}get renderCoordinate(){return{x:-this.width/2,y:-this.height/2}}beforeDraw(){this.ctx.translate(this.x+this.width/2,this.y+this.height/2),this.isFreezeBall||this.ctx.rotate(this.angle*(Math.PI/180))}applyGravity(){this.velocity.y+=this.gravity}applyVelocity(){this.y+=this.velocity.y,this.x+=this.velocity.x}canChangeSize(t){return t>=this.minScale&&t<=this.maxScale}updateSize(t){this.width*=t,this.height*=t}changeSize(t){const e=this.scale+t;this.canChangeSize(e)&&(this.scale=e,this.updateSize(1+t))}increaseSize(){this.changeSize(this.scaleAmount)}decreaseSize(){this.changeSize(-this.scaleAmount)}resetToDefaultSize(){this.scale=1,this.width=this.actualSize.width,this.height=this.actualSize.height}freezeBall(){this.previousVelocity=this.velocity,this.velocity={x:0,y:0},this.isFreezeBall=!0}unFreezeBall(){this.velocity=this.previousVelocity,this.previousVelocity=null,this.isFreezeBall=!1}}class b extends m{constructor({gameInstance:t,...e}){super(e),this.game=t,this.gravity=.03,this.velocity={x:0,y:0}}update(){super.update(),this.applyGravity(),this.applyVelocity()}applyGravity(){this.velocity.y+=this.gravity}applyVelocity(){this.y+=this.velocity.y}activatePowerUp(){}}class Y extends b{constructor(t){super(t),this.image=this.game.assetLoader.assets.decreaseBall}activatePowerUp(){super.activatePowerUp(),this.game.ball.decreaseSize()}}class J extends b{constructor(t){super(t),this.image=this.game.assetLoader.assets.increaseBall}activatePowerUp(){super.activatePowerUp(),this.game.ball.increaseSize()}}class Z extends b{constructor(t){super(t),this.image=this.game.assetLoader.assets.diamondIce,this.freezeDuration=3e3}activatePowerUp(){super.activatePowerUp(),this.game.ball.freezeBall(),this.game.isPowerUpActive=!0,this.game.intervalIds.powerUpActivation&&clearTimeout(this.game.intervalIds.powerUpActivation);const t=setTimeout(()=>{this.game.ball.unFreezeBall(),this.game.isPowerUpActive=!1,this.game.intervalIds.powerUpActivation=null},this.freezeDuration);this.game.intervalIds.powerUpActivation=t}}class j extends p{constructor({x:t,y:e,width:s,height:i,image:r,scale:n,gameInstance:o,...h}){super(h),this.x=t,this.y=e,this.width=s,this.height=i,this.image=r,this.scale=n,this.game=o,this.topPart={x:-this.width,y:this.y},this.bottomPart={x:this.game.width,y:this.y+this.height/2},this.currentFrame=0,this.step=60,this.isShow=!1}getPosition(t){const{width:e,height:s}=this.image,i={top:0,bottom:s/2},r={top:this.topPart,bottom:this.bottomPart},{x:n,y:o}=r[t],h=[0,i[t],e,s/2],c=[n,o,this.width,this.height/2];return[this.image,...h,...c]}drawTopPart(){this.ctx.drawImage(...this.getPosition("top"))}drawBottomPart(){this.ctx.drawImage(...this.getPosition("bottom"))}draw(){this.ctx.save(),this.drawTopPart(),this.drawBottomPart(),this.ctx.restore()}async animate({top:t,bottom:e}){const s=t-this.topPart.x,i=e-this.bottomPart.x,r=this.topPart.x,n=this.bottomPart.x;return new Promise(o=>{const h=()=>{if(this.currentFrame>this.step)return this.currentFrame=0,o();this.topPart.x=r+L(s,this.currentFrame,this.step),this.bottomPart.x=n+L(i,this.currentFrame,this.step),this.currentFrame++,requestAnimationFrame(h)};h()})}async show(){await this.animate({top:this.x,bottom:this.x}),this.isShow=!0}async hide(){await this.animate({top:this.game.width,bottom:-this.width}),this.isShow=!1}}class S extends p{constructor({x:t,y:e,fontFamily:s="Arial",fontSize:i=16,fontWeight:r="normal",color:n="#000",text:o,...h}){super(h),this.x=t,this.y=e,this.text=o,this.fontFamily=s,this.fontSize=i,this.fontWeight=r,this.color=n}draw(t=null){this.ctx.save(),this.ctx.font=`${this.fontWeight} ${this.fontSize}px ${this.fontFamily}`,this.ctx.fillStyle=this.color,this.ctx.fillText(this.text,this.x,this.y),this.ctx.restore()}}class Q extends p{constructor({gameInstance:t,...e}){super(e),this.game=t,this.scoreText={player:null,opponent:null},this.init()}init(){const{player:t,opponent:e}=this.game.score,s=this.game.width/2,i={ctx:this.ctx,y:85,fontSize:42,fontWeight:"bold",color:"#fff"};this.scoreText.player=new S({...i,text:t,x:s-85}),this.scoreText.opponent=new S({...i,text:e,x:s+60})}drawFlag(t){const{flag:e,scoreBar:s}=this.game.assetLoader.assets,i=e[t],r=this.game.width/2,n=s.width/2,o={x:20,y:20},h=.6,c={player:r-i.width*h-n-o.x,opponent:r+n+o.x};this.ctx.drawImage(i,c[t],o.y,i.width*h,i.height*h)}draw(){const{scoreBar:t}=this.game.assetLoader.assets,e=this.game.width/2-t.width/2;this.ctx.drawImage(t,e,30,t.width,t.height);for(const s in this.scoreText)this.scoreText[s].draw(),this.scoreText[s].text=this.game.score[s],this.drawFlag(s)}}class A{constructor({selector:t,isOpen:e=!1,canClose:s=()=>!0,onConfirm:i=()=>{}}){this.selector=t,this.el=document.querySelector(this.selector),this.isOpen=e,this.isAnimating=!1,this.canClose=s,this.onConfirm=i,this.modalEl=this.el.querySelector(".modal"),this.init()}init(){this.isOpen?(this.el.classList.remove("hide"),this.el.classList.add("show")):this.el.classList.add("hide")}async show(){if(!this.isAnimating)return new Promise(t=>{this.el.classList.contains("hide")&&this.el.classList.remove("hide"),this.isOpen=!0,this.el.classList.add("show"),this.modalEl.classList.add("modal-show"),this.isAnimating=!0;const e=()=>(this.handleEndAnimation(),this.modalEl.removeEventListener("animationend",e),t());this.modalEl.addEventListener("animationend",e)})}hide(){if(!this.isAnimating)return new Promise(t=>{this.el.classList.contains("show")&&this.el.classList.remove("show"),this.isOpen=!1,this.modalEl.classList.add("modal-disapear"),this.isAnimating=!0;const e=()=>(this.handleEndAnimation(),this.modalEl.removeEventListener("animationend",e),t());this.modalEl.addEventListener("animationend",e)})}handleEndAnimation(){this.isOpen?this.modalEl.classList.remove("modal-show"):(this.modalEl.classList.remove("modal-disapear"),this.el.classList.add("hide")),this.isAnimating=!1}}class tt extends A{constructor(t){super({selector:"#game-over-dialog",...t})}init(){super.init(),document.querySelector(".btn-dialog-restart").addEventListener("click",this.handleRestart.bind(this)),document.querySelector(".btn-dialog-leaderboard").addEventListener("click",this.handleLeaderboard.bind(this))}handleRestart(){window.location.reload()}handleLeaderboard(){console.log("Leaderboard TBA...")}update({username:t,flag:e,score:s}){const i=document.querySelector("#username-area"),r=document.querySelector("#player-score-flag img"),n=document.querySelector("#opponent-score-flag img"),o=document.querySelector("#player-score-text"),h=document.querySelector("#opponent-score-text"),c=d[e.player].name,w=d[e.opponent].name;i.innerHTML=t,r.src=`./assets/Flag/${c}.png`,n.src=`./assets/Flag/${w}.png`,o.innerHTML=s.player,h.innerHTML=s.opponent}}class et{constructor({canvas:t,background:e,ball:s,player:i,opponent:r,username:n,level:o}){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.selectedPlayer={player:i,opponent:r},this.selectedBall=M[s],this.selectedBackground=G[e],this.username=n,this.level=o,this.gameDuration=H[this.level],this.startTimestamp=null,this.elapsedTime=0,this.currentTime=this.gameDuration,this.character={player:null,opponent:null},this.background=null,this.flagBoard=null,this.ball=null,this.goals={},this.powerUpItems=[],this.goalText=null,this.scoreBoard=null,this.timerText=null,this.bottomGap=70,this.isResetPosition=!1,this.isSuddenDeath=!1,this.score={player:0,opponent:0},this.assetLoader=new W({backgroundType:this.selectedBackground,ballType:this.selectedBall,player:this.selectedPlayer.player,opponent:this.selectedPlayer.opponent}),this.characterRespawnPos={x:150,y:100},this.availablePowerUpItems=[Y,J,Z],this.isPowerUpActive=!1,this.intervalIds={spawnPowerUp:null,powerUpActivation:null,countDownTimer:null},this.pause=!1,this.gameOverDialog=new tt}get width(){return this.canvas.width}get height(){return this.canvas.height}async init(){await this.assetLoader.loadAssets(),this.initBackground(),this.initCharacter(),this.initGoals(),this.initBall(),this.initGoalText(),this.initScoreBoard(),this.spawnPowerUpItem(),this.initCountDownTimer(),this.initTimerText(),setInterval(()=>{this.character.opponent.kick()},2500),this.registerEventHandler(),requestAnimationFrame(this.render.bind(this))}registerEventHandler(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this))}handleKeyDown(t){I(t.code)&&(v(t.code)?this.character.player.move(q[t.code]):U(t.code)?this.character.player.jump():k(t.code)&&this.character.player.kick())}handleKeyUp(t){I(t.code)&&v(t.code)&&this.character.player.stopMove()}initBackground(){this.background=new D({ctx:this.ctx,width:this.width,height:this.height,type:this.selectedBackground,image:this.assetLoader.assets.background}),this.flagBoard=new E({ctx:this.ctx,x:0,y:380,height:60,width:100,flagImage:this.assetLoader.assets.flag})}initCharacter(){const{width:t,height:e}=this.assetLoader.assets.character.player[l.idle][0],s=2.3,{width:i,height:r}={width:t/s,height:e/s},n={width:i,height:r,gameInstance:this,ctx:this.ctx};this.character.player=new T({...n,x:this.characterRespawnPos.x,y:this.characterRespawnPos.y,sprites:this.assetLoader.assets.character.player}),this.character.opponent=new T({...n,x:this.width-i-this.characterRespawnPos.x,y:this.characterRespawnPos.y,isFlip:!0,sprites:this.assetLoader.assets.character.opponent})}initGoals(){const{width:t,height:e}=this.assetLoader.assets.goal,s=1.5,i={ctx:this.ctx,width:t/s,height:e/s,image:this.assetLoader.assets.goal},r=new P({...i,x:50,y:260,side:"left"}),n=new P({...i,x:this.width-t/s-50,y:260,isFlip:!0,side:"right"});this.goals={left:r,right:n}}initBall(){const{width:t,height:e}=this.assetLoader.assets.ball,s=2.5,{width:i,height:r}={width:t/s,height:e/s};this.ball=new X({width:i,height:r,gameInstance:this,ctx:this.ctx,x:this.width/2-i/2,y:120,image:this.assetLoader.assets.ball})}initGoalText(){const{width:e,height:s}=this.assetLoader.assets.goalText;this.goalText=new j({scale:.4,gameInstance:this,ctx:this.ctx,x:(this.width-e*.4)/2,y:(this.height-s*.4)/2,width:e*.4,height:s*.4,image:this.assetLoader.assets.goalText})}initScoreBoard(){this.scoreBoard=new Q({gameInstance:this,ctx:this.ctx})}initCountDownTimer(){const t=()=>{const e=Math.floor(this.elapsedTime/1e3);if(this.currentTime=this.gameDuration-e,this.currentTime===0){this.score.player===this.score.opponent?(this.isSuddenDeath=!0,this.timerText.x-=90,this.timerText.fontSize=32):this.stopGame(),clearTimeout(this.intervalIds.countDownTimer),this.intervalIds.countDownTimer=null;return}this.intervalIds.countDownTimer=setTimeout(t,1e3)};t()}initTimerText(){this.timerText=new S({ctx:this.ctx,x:this.canvas.width/2-25,fontWeight:"bold",y:165,fontSize:48,color:"#225497",text:this.currentTime})}spawnPowerUpItem(){const t=this.generatePowerUpItem();this.powerUpItems.push(t),this.intervalIds.spawnPowerUp=setTimeout(this.spawnPowerUpItem.bind(this),1e3)}generatePowerUpItem(){const e=g(0,this.availablePowerUpItems.length-1),s=this.availablePowerUpItems[e],i=g(50,this.width-50);return new s({gameInstance:this,ctx:this.ctx,x:i,y:-50,width:50,height:50})}handleCharacterCollideWithBall(t){const e={x:g(8,15),y:g(8,15)};this.ball.isFreezeBall||(t==="left"?(e.x*=-1,e.y*=-1):t==="top"&&(e.y*=-1),this.ball.velocity.x=e.x,this.ball.velocity.y=e.y)}handleBallCollisionDirection(t,e){let s=10;(e==="top"&&!t.isGoal||t.side==="right")&&(s*=-1),this.ball.velocity.x=s,this.ball.velocity.y=s,t.isGoal=!1}handleBallCollideWithGoals(t,e){if(t.side==="left"&&e==="right"||t.side==="right"&&e==="left"){t.isGoal=!0;const s={left:"opponent",right:"player"};if(!this.isResetPosition){if(this.score[s[t.side]]++,this.isResetPosition=!0,this.isSuddenDeath){this.stopGame();return}this.resetPosition()}return}this.handleBallCollisionDirection(t,e)}stopGame(){setTimeout(()=>{for(const e in this.intervalIds)clearTimeout(this.intervalIds[e]);this.pause=!0,this.gameOverDialog.update({username:this.username,flag:this.selectedPlayer,score:this.score}),this.gameOverDialog.show()},60)}resetPosition(){this.goalText.show();const t=()=>{this.character.player.velocity={x:0,y:0},this.character.opponent.velocity={x:0,y:0},this.ball.velocity={x:0,y:0}},e=()=>{const{x:r,y:n}=this.characterRespawnPos,{width:o}=this.character.opponent;this.character.player.x=r,this.character.player.y=n,this.character.opponent.x=this.width-o-r,this.character.opponent.y=n},s=()=>{this.ball.x=this.width/2-this.ball.width/2,this.ball.y=120};setTimeout(()=>{this.isResetPosition=!1,this.powerUpItems=[],t(),e(),s(),this.goalText.hide(),this.ball.resetToDefaultSize(),this.ball.isFreezeBall&&(this.ball.unFreezeBall(),this.isPowerUpActive=!1,clearTimeout(this.intervalIds.powerUpActivation),this.intervalIds.powerUpActivation=null)},2e3)}draw(){this.background.draw(),this.flagBoard.draw(),this.character.player.draw(),this.character.opponent.draw(),this.ball.draw(),this.goalText.draw(),this.scoreBoard.draw(),this.timerText.draw(),this.timerText.text=this.isSuddenDeath?"Sudden Death":this.currentTime;for(const t of Object.keys(this.goals)){const e=this.goals[t];if(e.draw(),x(e,this.ball)){const s=C(e,this.ball);this.handleBallCollideWithGoals(e,s)}}for(const t in this.character){const e=this.character[t];if(x(e,this.ball)){const s=C(e,this.ball);this.handleCharacterCollideWithBall(s)}}for(const[t,e]of this.powerUpItems.entries())e.draw(),x(e,this.ball)&&!this.isResetPosition&&(e.activatePowerUp(),this.powerUpItems.splice(t,1))}simulateOpponentBotMove(){const t=this.ball.x+this.ball.width/2,e=this.character.opponent.x+this.character.opponent.width/2,s=t-e,i=Number((s*.05).toFixed()),r=this.character.opponent.moveSpeed,n=V(i,-r,r);this.character.opponent.velocity.x=n}render(t){if(this.pause)return;this.startTimestamp===null&&(this.startTimestamp=t),this.elapsedTime=t-this.startTimestamp;const e=_(this.elapsedTime%1e3,0,1e3,0,360);this.ball.angle=e,this.simulateOpponentBotMove(),this.ctx.clearRect(0,0,this.width,this.height),this.draw(),requestAnimationFrame(this.render.bind(this))}}class y{constructor({selector:t,manager:e}){this.selector=t,this.screen=document.querySelector(this.selector),this.manager=e}init(){}show(){this.screen.classList.contains("hide")&&this.screen.classList.remove("hide"),this.screen.classList.add("show"),this.init()}hide(){this.screen.classList.contains("show")&&this.screen.classList.remove("show"),this.screen.classList.add("hide")}}class st extends y{constructor(t){super({selector:".countdown-screen",...t}),this.timer=null,this.countdown=3,this.wrapper=this.screen.querySelector(".countdown-screen-wrapper")}init(){super.init(),this.timer=setInterval(()=>{if(this.countdown===1){clearInterval(this.timer),this.manager.changeScreen("game");return}const t=`<h1 class="countdown-text">${--this.countdown}</h1>`;this.wrapper.innerHTML=t},1e3)}}class it extends y{constructor(t){super({selector:".game-screen",...t})}init(){super.init();const{player:t,opponent:e}=this.manager.selectedPlayer,s=document.querySelector("#canvas");new et({canvas:s,player:t,opponent:e,username:this.manager.username,level:this.manager.gameLevel,background:this.manager.selectedBg,ball:this.manager.selectedBall}).init()}}class at extends A{constructor(t){super({selector:"#player-dialog",...t})}init(){super.init(),document.querySelector(".btn-dialog-next").addEventListener("click",async()=>{this.canClose()&&(await this.hide(),this.onConfirm())})}}class B{constructor(t){this.selector=t,this.el=document.querySelector(this.selector),this.characters=[],this.init()}init(){this.characters=[...this.el.querySelectorAll(".character-item")];for(const[t,e]of this.characters.entries())e.addEventListener("click",this.handleCharacterClick.bind(this,e,t))}get activeCharacter(){return this.el.querySelector(".character-item.active")}get activeCharacterName(){var t;return((t=this.activeCharacter)==null?void 0:t.getAttribute("data-value"))??null}handleCharacterClick(t,e){const s=this.el.querySelector(".character-selection-wrapper");if(this.activeCharacter.classList.remove("active"),e===0||e===this.characters.length-1){s.style.transition="none";const r={0:{distanceFromTop:t.clientHeight*7-50*7,order:8},[this.characters.length-1]:{distanceFromTop:0,order:1}},{distanceFromTop:n,order:o}=r[e];s.style.transform=`translateY(-${n}px)`,this.characters[o].classList.add("active"),setTimeout(()=>s.style.transition=".3s ease");return}t.classList.add("active");const i=t.clientHeight*(e-1)-50*(e-1);s.style.transform=`translateY(-${i}px)`}}class rt extends y{constructor(t){super({selector:".selection-screen",...t}),this.playerCharacterSelection=new B("#player-character"),this.opponentCharacterSelection=new B("#opponent-character"),this.playerDialog=new at({isOpen:!1,onConfirm:this.onConfirmDialog.bind(this),canClose:()=>!!this.usernameField.value}),this.usernameField=document.querySelector("#username")}init(){super.init(),document.querySelector(".btn-next").addEventListener("click",this.nextHandler.bind(this))}async nextHandler(){await this.playerDialog.show()}onConfirmDialog(){this.manager.selectedPlayer={player:this.playerCharacterSelection.activeCharacterName,opponent:this.opponentCharacterSelection.activeCharacterName},this.manager.selectedBall=f("ball"),this.manager.selectedBg=f("stadium"),this.manager.gameLevel=f("level"),this.manager.username=this.usernameField.value,this.manager.changeScreen("countdown")}}class nt extends y{constructor(t){super({selector:".welcome-screen",...t})}init(){super.init(),document.querySelector(".btn-play").addEventListener("click",this.playHandler.bind(this))}playHandler(){this.manager.changeScreen("selection")}}class ot{constructor(){this.screens={welcome:nt,selection:rt,countdown:st,game:it},this.activeScreen="welcome",this.username=null,this.gameLevel=null,this.selectedBall=null,this.selectedBg=null,this.selectedPlayer={player:null,opponent:null}}get screen(){return new this.screens[this.activeScreen]({manager:this})}init(){this.screen.show()}changeScreen(t){this.screen.hide(),this.activeScreen=t,this.screen.show()}}const ht=new ot;ht.init();
